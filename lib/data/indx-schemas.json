{
    "LICENSE": [
        "Copyright (C) 2011-2013 University of Southampton",
        "Copyright (C) 2011-2013 Daniel Alexander Smith",
        "Copyright (C) 2011-2013 Max Van Kleek",
        "Copyright (C) 2011-2013 Nigel R. Shadbolt",
        "",
        "This program is free software: you can redistribute it and/or modify",
        "it under the terms of the GNU Affero General Public License, version 3,",
        "as published by the Free Software Foundation.",
        "",
        "This program is distributed in the hope that it will be useful,",
        "but WITHOUT ANY WARRANTY; without even the implied warranty of",
        "MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
        "GNU Affero General Public License for more details.",
        "",
        "You should have received a copy of the GNU Affero General Public License",
        "along with this program.  If not, see <http://www.gnu.org/licenses/>."
    ],
    "store-updates": {
        "first-version": "20131126-FIX_DIFF_VIEW",
        "versions": {
            "20131126-FIX_DIFF_VIEW": {
                "next-version": "",
                "sql": [
                    "CREATE OR REPLACE VIEW wb_v_diffs AS ",
                    " SELECT wb_vers_diffs.version, wb_vers_diffs.diff_type, ",
                    "    j_subject.string AS subject, j_predicate.string AS predicate, ",
                    "    j_object.string AS obj_value, wb_objects.obj_type, wb_objects.obj_lang, ",
                    "    wb_objects.obj_datatype, wb_vers_diffs.object_order",
                    "   FROM wb_vers_diffs",
                    "   LEFT JOIN wb_objects ON wb_objects.id_object = wb_vers_diffs.object",
                    "   LEFT JOIN wb_strings j_subject ON j_subject.id_string = wb_vers_diffs.subject",
                    "   LEFT JOIN wb_strings j_predicate ON j_predicate.id_string = wb_vers_diffs.predicate",
                    "   LEFT JOIN wb_strings j_object ON j_object.id_string = wb_objects.obj_value",
                    "  ORDER BY wb_vers_diffs.version, wb_vers_diffs.diff_type, j_subject.string, j_predicate.string, wb_vers_diffs.object_order, j_object.string, wb_objects.obj_type, wb_objects.obj_lang, wb_objects.obj_datatype;"
                ]
            }
        }
    },
    "updates": {
        "first-version": "20131013-ADD_INDX_CORE_AND_USER_METADATA",
        "versions": {
            "20131013-ADD_INDX_CORE_AND_USER_METADATA": {
                "next-version": "20131028-ADD_ACL_TABLE",
                "sql": [
                    "CREATE TABLE tbl_indx_core",
                    "(",
                    "  id_indx serial NOT NULL,",
                    "  key text NOT NULL,",
                    "  value text NOT NULL,",
                    "  CONSTRAINT pk_id_indx PRIMARY KEY (id_indx)",
                    ")",
                    "WITH (",
                    "  OIDS=FALSE",
                    ");",
                    "",
                    "ALTER TABLE tbl_users ADD COLUMN user_metadata_json text NULL;"
                ]
            },
            "20131028-ADD_ACL_TABLE": {
                "next-version": "20131031-ADD_PKI_KEY_STORAGE",
                "sql": [
                    "CREATE TABLE tbl_acl",
                    "(",
                    "  id_acl serial NOT NULL,",
                    "  database_name text NOT NULL,",
                    "  user_id integer NOT NULL,",
                    "  acl_read boolean NOT NULL,",
                    "  acl_write boolean NOT NULL,",
                    "  acl_owner boolean NOT NULL,",
                    "  acl_control boolean NOT NULL,",
                    "  CONSTRAINT pk_id_acl PRIMARY KEY (id_acl)",
                    ")",
                    "WITH (",
                    "    OIDS=FALSE",
                    ");"
                ]
            },
            "20131031-ADD_PKI_KEY_STORAGE": {
                "next-version": "20131107-ADD_ROOT_BOX",
                "sql": [
                    "ALTER TABLE tbl_users ADD COLUMN public_key_rsa text NULL;",
                    "ALTER TABLE tbl_users ADD COLUMN private_key_rsa_env text NULL;"
                ]
            },
            "20131107-ADD_ROOT_BOX": {
                "next-version": "20131112-ADD_INTERNAL_USER_TYPE-HAPPY_BIRTHDAY",
                "sql": [
                    "ALTER TABLE tbl_users ADD COLUMN root_box text NULL;"
                ]
            },
            "20131112-ADD_INTERNAL_USER_TYPE-HAPPY_BIRTHDAY": {
                "next-version": "20131119-ADD_KEYSTORE_TABLE",
                "sql": [
                    "ALTER TYPE uname_type ADD VALUE 'internal';"
                ]
            },
            "20131119-ADD_KEYSTORE_TABLE": {
                "next-version": "20131126-ALTER_BOXES_DIFF_VIEW",
                "sql": [
                    "CREATE TABLE tbl_keystore",
                    "(",
                    "  id_keystore serial NOT NULL,",
                    "  public_hash text NOT NULL,",
                    "  public_key text NOT NULL,",
                    "  private_key text NOT NULL,",
                    "  CONSTRAINT pk_id_keystore PRIMARY KEY (id_keystore)",
                    ")",
                    "WITH (",
                    "    OIDS=FALSE",
                    ");"
                ]
            },
            "20131126-ALTER_BOXES_DIFF_VIEW": {
                "next-version": "20131205-ADD_USERNAME_TO_KEYSTORE",
                "sql": [
                    "ALTER TABLE tbl_indx_core ADD COLUMN boxid text NULL;"
                ]
            },
            "20131205-ADD_USERNAME_TO_KEYSTORE": {
                "next-version": "20140103-ADD_BOX_TO_KEYSTORE",
                "sql": [
                    "ALTER TABLE tbl_keystore ADD COLUMN username text NULL;"
                ]
            },
            "20140103-ADD_BOX_TO_KEYSTORE": {
                "next-version": "",
                "sql": [
                    "ALTER TABLE tbl_keystore ADD COLUMN box text NULL;"
                ]
            }
        }
    },
    "base": {
        "indx-schema.sql": [
            "CREATE TYPE uname_type AS ENUM ('local_owner', 'local', 'openid');",
            "",
            "CREATE TABLE tbl_users",
            "(",
            "  id_user serial NOT NULL,",
            "  username text NOT NULL,",
            "  username_type uname_type NOT NULL,",
            "  password_hash character varying(128) NOT NULL,",
            "  password_encrypted text NOT NULL,",
            "  CONSTRAINT pk_id_user PRIMARY KEY (id_user),",
            "  CONSTRAINT u_username UNIQUE (username)",
            ")",
            "WITH (",
            "  OIDS=FALSE",
            ");",
            "",
            "CREATE TYPE db_user_typ AS ENUM ('rw', 'ro');",
            "",
            "CREATE TABLE tbl_keychain",
            "(",
            "  id_key serial NOT NULL,",
            "  user_id integer NOT NULL,",
            "  db_name character varying(64) NOT NULL,",
            "  db_user character varying(64) NOT NULL,",
            "  db_user_type db_user_typ NOT NULL,",
            "  db_password_encrypted text NOT NULL,",
            "  CONSTRAINT pk_id_key PRIMARY KEY (id_key),",
            "  CONSTRAINT fk_user_id FOREIGN KEY (user_id)",
            "      REFERENCES tbl_users (id_user) MATCH SIMPLE",
            "      ON UPDATE NO ACTION ON DELETE NO ACTION",
            ")",
            "WITH (",
            "    OIDS=FALSE",
            ");"
        ]
    }

}
