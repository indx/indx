<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title></title>
	<meta name="description" content="">
	<meta name="author" content="">

	<meta name="viewport" content="width=device-width,initial-scale=1">

	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/dyntab.css">

	<script src="js/libs/modernizr-2.0.6.min.js"></script>
</head>
<body>

<div id="container">
	<header>
        <h1>WebBox Browser</h1>

        <p>This is a WebBox, see <a href="http://github.com/danielsmith-eu/webbox/wiki/">the WebBox Wiki</a> for more information.</p>
	</header>
	<div id="main" role="main">

        <div id="status"></div>
        <div id="browser_table"></div>

	</div>
	<footer>

	</footer>
</div> <!--! end of #container -->

<!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>
-->
<script src="js/jquery-1.7.2.js"></script>

<!-- scripts concatenated and minified via ant build script-->
<script src="js/dynamictable.js"></script>
<script src="js/plugins.js"></script>
<script src="js/script.js"></script>
<!-- end scripts-->

<script>

$(document).ready(function(){

    $("#status").html("Loading items...");
    var prefixes = "PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> ";

    $.ajax(
        { "url": "/webbox/",
          "cache": false,
          "crossDomain": true,
          "data": {
              "query": prefixes+"CONSTRUCT {?item rdf:type ?type} WHERE {?item rdf:type ?type}",
          },
          "dataType": "json", // also sets the accept header
          "success": function(data, textStatus, jqXHR){

              var newdata = {};
              $.each(data["@graph"], function(){
                  var item = this;
                  var newitem = {};
                  if ("@id" in item){
                      $.each(item, function(key, val){
                          if (key == "@type"){
                              newitem["rdf:type"] = val;
                          } else if (key == "@id"){
                              // do nothing
                          } else {
                              newitem[key] = val["@value"];
                          }
                      });
                      var id = item["@id"];
                      newitem["uri"] = id;
                      newdata[id] = newitem;
                  }
              });

              var columns = [
                  {"uri": "uri", "label": "URI"},
                  {"uri": "rdf:type", "label": "Type"},
              ];

              $("#status").html("Rendering items...");
              var dt = new DynamicTable($("#browser_table"), {"data": newdata, "columns": columns });
              $("#status").html("");
          },
        }
    );

});

</script>

<!--[if lt IE 7 ]>
	<script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.2/CFInstall.min.js"></script>
	<script>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})})</script>
<![endif]-->

</body>
</html>
